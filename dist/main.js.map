{"version":3,"sources":["../main.js"],"names":["baseURL","getEndpoint","id","type","limit","offset","query","stringify","encode","resolve","encodeURIComponent","City","Promise","reject","options","url","json","headers","then","result","data","map","Sight","name","sight","attributes","address","street","hours_string","price_string","review","catch","parameters","Object","assign","LonelyPlanet","$","load","body","href","attr","split","pop"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA,IAAMA,UAAU,+BAAhB;;AAEA,SAASC,WAAT,CAAqBC,EAArB,EAAoE;AAAA,QAA3CC,IAA2C,uEAApC,QAAoC;AAAA,QAA1BC,KAA0B,uEAAlB,IAAkB;AAAA,QAAZC,MAAY,uEAAH,CAAG;;AAChE,QAAMC,QAAQ,aAAGC,SAAH,CAAa;AACvB,yCAAiCJ,IADV;AAEvB,+CAAuCD,EAFhB;AAGvB,uBAAeE,KAHQ;AAIvB,wBAAgBC;AAJO,KAAb,EAKX,EAACG,QAAQ,KAAT,EALW,CAAd;;AAOA,WAAO,cAAIC,OAAJ,CAAYT,OAAZ,EAAqB,eAAaE,EAAb,kBAA8BQ,mBAAmB,WAAWJ,KAA9B,CAAnD,CAAP;AACH;;IAEKK,I;AACF,kBAAYT,EAAZ,EAAgBI,KAAhB,EAAuB;AAAA;;AACnB,aAAKJ,EAAL,GAAUA,EAAV;AACA,aAAKI,KAAL,GAAaA,KAAb;AACH;;;;iCAEQ;AAAA;;AACL,mBAAO,IAAIM,OAAJ,CAAY,UAACH,OAAD,EAAUI,MAAV,EAAqB;AACpC,oBAAMC,UAAU;AACZC,yBAAKd,YAAY,MAAKC,EAAjB,CADO;AAEZc,0BAAM,IAFM;AAGZC,6BAAS;AACL,wCAAgB;AADX;AAHG,iBAAhB;;AAQA,8CAAGH,OAAH,EACKI,IADL,CACU,kBAAU;AACZT,4BAAQU,OAAOC,IAAP,CAAYC,GAAZ,CAAgB,iBAAS;AAC7B,+BAAO,IAAIC,KAAJ,CAAU;AACbC,kCAAMC,MAAMC,UAAN,CAAiBF,IADV;AAEbG,qCAASF,MAAMC,UAAN,CAAiBC,OAAjB,CAAyBC,MAFrB;AAGbC,0CAAcJ,MAAMC,UAAN,CAAiBG,YAHlB;AAIbC,0CAAcL,MAAMC,UAAN,CAAiBI,YAJlB;AAKbC,oCAAQN,MAAMC,UAAN,CAAiBK;AALZ,yBAAV,CAAP;AAOH,qBARO,CAAR;AASH,iBAXL,EAYKC,KAZL,CAYWlB,MAZX;AAaH,aAtBM,CAAP;AAuBH;;;;;;IAGCS,K,GACF,eAAYU,UAAZ,EAAwB;AAAA;;AACpBC,WAAOC,MAAP,CAAc,IAAd,EAAoBF,UAApB;AACH,C;;IAGgBG,Y;;;;;;;6BACZ7B,K,EAAO;AACR,mBAAO,IAAIM,OAAJ,CAAY,UAACH,OAAD,EAAUI,MAAV,EAAqB;AACpC,8CAAGb,UAAUM,KAAb,EACKY,IADL,CACU,gBAAQ;AACV,wBAAMkB,IAAI,kBAAQC,IAAR,CAAaC,IAAb,CAAV;AACA,wBAAMC,OAAOH,EAAE,eAAF,EAAmBI,IAAnB,CAAwB,MAAxB,CAAb;;AAEA,wBAAID,IAAJ,EACI9B,QAAQ,IAAIE,IAAJ,CAAS4B,KAAKE,KAAL,CAAW,GAAX,EAAgBC,GAAhB,EAAT,EAAgCpC,KAAhC,CAAR;AACP,iBAPL,EAQKyB,KARL,CAQWlB,MARX;AASH,aAVM,CAAP;AAWH;;;;;;kBAbgBsB,Y","file":"main.js","sourcesContent":["import qs from 'qs';\r\nimport url from 'url';\r\nimport cheerio from 'cheerio';\r\nimport rp from 'request-promise';\r\n\r\nconst baseURL = 'https://www.lonelyplanet.com/';\r\n\r\nfunction getEndpoint(id, type = 'sights', limit = 1000, offset = 0) {\r\n    const query = qs.stringify({\r\n        'filter[poi][poi_type][equals]': type,\r\n        'filter[poi][place_id][has_ancestor]': id,\r\n        'page[limit]': limit,\r\n        'page[offset]': offset\r\n    }, {encode: false});\r\n\r\n    return url.resolve(baseURL, `a/poi-sig/${id}?resource=` + encodeURIComponent('/pois?' + query))\r\n}\r\n\r\nclass City {\r\n    constructor(id, query) {\r\n        this.id = id;\r\n        this.query = query;\r\n    }\r\n\r\n    sights() {\r\n        return new Promise((resolve, reject) => {\r\n            const options = {\r\n                url: getEndpoint(this.id),\r\n                json: true,\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            };\r\n\r\n            rp(options)\r\n                .then(result => {\r\n                    resolve(result.data.map(sight => {\r\n                        return new Sight({\r\n                            name: sight.attributes.name,\r\n                            address: sight.attributes.address.street,\r\n                            hours_string: sight.attributes.hours_string,\r\n                            price_string: sight.attributes.price_string,\r\n                            review: sight.attributes.review,\r\n                        })\r\n                    }));\r\n                })\r\n                .catch(reject)\r\n        })\r\n    }\r\n}\r\n\r\nclass Sight {\r\n    constructor(parameters) {\r\n        Object.assign(this, parameters);\r\n    }\r\n}\r\n\r\nexport default class LonelyPlanet {\r\n    city(query) {\r\n        return new Promise((resolve, reject) => {\r\n            rp(baseURL + query)\r\n                .then(body => {\r\n                    const $ = cheerio.load(body);\r\n                    const href = $('.sights__more').attr('href');\r\n\r\n                    if (href)\r\n                        resolve(new City(href.split('/').pop(), query));\r\n                })\r\n                .catch(reject)\r\n        })\r\n    }\r\n}"]}